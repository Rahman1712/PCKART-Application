<main id="main" class="main">
  <div class="pagetitle">
    <h1>Product Update</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a routerLink="/dashboard" routerLinkActive="active">Home</a></li>
        <li class="breadcrumb-item"><a routerLink="/products" routerLinkActive="active">Products</a>
        </li>
        <li class="breadcrumb-item active">Product Update : <b>#{{product.id}}</b> </li>
      </ol>
    </nav>
  </div>

  <section class="section">
    <div class="container mt-5">
      <div class="card p-2">
        <form #productForm="ngForm" (ngSubmit)="updateProduct(productForm, product.id)">
          <div class="row">
            <div class="col-md-6">
              <div class="col-12">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Product Name</mat-label>
                  <input ngNativeValidate required matInput id="productName" name="productName" [(ngModel)]="product.name" placeholder="Product Name">
                </mat-form-field>
              </div>
        
              <div class="row">
                <div class="col-md-6">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Price</mat-label>
                    <input ngNativeValidate required matInput id="ProductPrice" name="price" [(ngModel)]="product.price" placeholder="Price">
                  </mat-form-field>
                </div>
        
                <div class="col-md-6">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Quantity</mat-label>
                    <input ngNativeValidate required matInput id="productQuantity" name="productQuantity" [(ngModel)]="product.quantity"
                      placeholder="Quantity">
                  </mat-form-field>
                </div>
        
              </div>
        
              <div class="row">
                <div class="col-md-6">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Discount</mat-label>
                    <input ngNativeValidate required matInput id="productDiscount" name="productDiscount" [(ngModel)]="product.discount"
                      placeholder="Discount">
                  </mat-form-field>
                </div>
                <div class="col-md-6">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Color</mat-label>
                    <input ngNativeValidate required matInput id="productColor" name="productColor" [(ngModel)]="product.color" placeholder="Color">
                  </mat-form-field>
                </div>
              </div>
        
              <div class="row">
                <div class="col-md-6">
                  <mat-form-field class="full-width">
                    <mat-label>Product Brand</mat-label>
                    <mat-select ngNativeValidate required id="productBrand" name="productBrand" [(ngModel)]="product.brand">
                      <mat-option *ngFor="let brand of brandsList" [value]="brand">
                        {{brand.name}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
        
                <div class="col-md-6">
                  <mat-form-field class="full-width">
                    <mat-label>Product Category</mat-label>
                    <mat-select ngNativeValidate required id="productCategory" name="productCategory" [(ngModel)]="product.category" panelClass="category-select-parent" [(value)]="product.category">
                      <!-- <mat-option>-- None --</mat-option> -->
                      <mat-optgroup *ngFor="let category of categoriesListHierarchy" [label]="category.parent.name"  >
                        <mat-option *ngFor="let subcategory of category.children" [value]="subcategory.parent">
                          {{subcategory.parent.name}}
                        </mat-option>
                      </mat-optgroup>
                    </mat-select>
                  
                    <!-- <mat-select id="productCategory" name="productCategory" [(ngModel)]="product.category">
                                        <mat-option *ngFor="let category of categoriesList" [value]="category">
                                          {{category.name}}
                                        </mat-option>
                                      </mat-select> -->
                  </mat-form-field>
                </div>
              </div>
        
              <div class="row">
                <div class="col-12">
                  <mat-form-field class="full-width">
                    <mat-label>Product Description</mat-label>
                    <textarea  matInput id="productDescription" placeholder="Product Description"
                      [(ngModel)]="product.description" name="productDescription"></textarea>
                  </mat-form-field>
                </div>
              </div>
        
              <div class="row">
                <div class="col-12">
                  <div class="card p-2">
                    <mat-accordion>
                      <mat-expansion-panel hideToggle>
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            Specifications
                          </mat-panel-title>
                          <mat-panel-description>
                            product specs key and value
                            <mat-icon aria-hidden="false" class="ms-3" aria-label="" fontIcon="more_horiz"></mat-icon>
                          </mat-panel-description>
                        </mat-expansion-panel-header>
                        <div class="col-12 " id="prodspecs_container" #specContainer>
                          <div class="row prodspec_row" #li_row>
                            <div class="col-md-4">
                              <div class="form-floating">
                                <input type="text" class="form-control" id="spec_key" placeholder="value">
                                <label for="spec_key">key</label>
                              </div>
                            </div>
        
                            <div class="col-md-4">
                              <div class="form-floating">
                                <input type="text" class="form-control" id="spec_value" placeholder="value">
                                <label for="spec_value">value</label>
                              </div>
                            </div>
        
                            <div class="col-md-4">
                              <div class="mt-2">
                                <button type="button" class="btn shadow text-success btnP">
                                  <i class="bi bi-plus"></i>
                                </button>
                                <button type="button" class="btn shadow text-danger btnM">
                                  <i class="bi bi-dash"></i>
                                </button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </mat-expansion-panel>
                    </mat-accordion>
                  </div>
                </div>
              </div>
        
              <div class="d-flex justify-content-end mb-2">
                <button type="button" mat-raised-button class="mx-1" (click)="clearForm(productForm)">clear</button>
                <button type="submit" mat-raised-button color="primary">update product</button>
              </div>
              <!-- </form> -->
            </div>
        
            <div class="col-md-6 mt-2">
              <mat-tab-group animationDuration="100ms">
                <mat-tab label="Main Image">
                  <mat-card class="mainimage-card">
                    <div>
                      <div class="dropzone mt-5" appDrag (files)="fileDropped($event)">
                        <div class="text-wrapper">
                          <div class="centered">
                            Drag and drop your file or
                            <a (click)="fileInput.click()" class="browse-btn"> browse </a>
                            a file
                          </div>
                        </div>
                      </div>
        
                      <!-- <button type="button" mat-raised-button (click)="fileInput.click()">Choose File</button> -->
                      <input hidden (change)="onFileSelected($event)" #fileInput type="file" id="file" accept=".jpeg, .jpg, .png">
                    </div>
                    <div class="mt-3">
                      <div class="row">
                        <mat-card class="mt-3 p-3">
                          <div style="position: relative" class="mainimage-card d-flex justify-content-center"
                            *ngIf="mainImageFile != undefined">
                            <img [src]="mainImageFile.url" width="100px" height="100px">
                          </div>
                        </mat-card>
                      </div>
                    </div>
                  </mat-card>
                </mat-tab>
                <mat-tab label="Sub Images">
                  <mat-card class="mainimage-card mt-2">
                    <div class="mt-2 d-flex justify-content-center">
                      <button type="button" mat-raised-button (click)="selectFile.click()">Choose File</button>
                      <input ngNativeValidate required hidden type="file" multiple #selectFile (change)="onMultipleFilesSelected($event)" accept=".jpeg, .jpg, .png">
                    </div>
                    <div class="mt-3">
                      <div class="row p-2">
                        <mat-grid-list cols="2" rowHeight="1:1">
                          <mat-grid-tile *ngFor="let file of subImagesFiles; let i= index;">
                            <div style="position: relative">
                              <span class="btn-remove-image" (click)="removeImages(i)">x</span>
                              <img [src]="file.url" width="100px" height="100px">
                            </div>
                          </mat-grid-tile>
                        </mat-grid-list>
                      </div>
                    </div>
                  </mat-card>
                </mat-tab>
                <mat-tab label="Image crop">
                  <mat-card class="mainimage-card mt-2">
                    <input ngNativeValidate required type="file" (change)="fileChangeEvent($event)" accept=".jpeg, .jpg, .png"/>
                    
                    <!-- [aspectRatio]="4 / 3"  -->
                    <!-- [resizeToWidth]="256" -->
                    <image-cropper 
                      [imageChangedEvent]="imageChangedEvent" 
                      [maintainAspectRatio]="true" 
                      format="png" 
                      [autoCrop]="true"
                      (imageCropped)="imageCropped($event)" 
                      (imageLoaded)="imageLoaded()" 
                      (cropperReady)="cropperReady()"
                      (loadImageFailed)="loadImageFailed()">
                    </image-cropper>
                    
                    <img [src]="croppedImage" />
                  </mat-card>
                </mat-tab>
              </mat-tab-group>
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>
</main>
